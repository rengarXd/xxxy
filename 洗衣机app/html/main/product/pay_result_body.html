<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>body</title>
		<link rel="stylesheet" type="text/css" href="../../../css/Hui.css" />
		<link rel="stylesheet" href="../../../css/style.css" />
		<link rel="stylesheet" href="../../../css/jquery.flipcountdown.css" />
	</head>
	<body>
		<div class="H-padding-vertical-both-5"></div>
		<div class="H-padding-vertical-top-20 H-padding-vertical-bottom-15 H-theme-background-color-white H-text-align-center">
			<span class="H-theme-font-color-333 H-font-size-26">支付成功</span>
			<div class="H-theme-font-color-999 H-font-size-13">
				抓紧时间把待洗的衣物放进洗衣机理
			</div>
			<div class="H-padding-vertical-both-8">
				<div id="retroclockbox"></div>
			</div>
			<div class="H-theme-font-color-999 H-font-size-13">
				后自动开始洗衣
			</div>
		</div>
		<div class="H-padding-horizontal-both-25 H-padding-vertical-top-15 H-padding-vertical-bottom-25">
			<button onclick="start();" class="xy_confirm_btn H-position-static H-button H-width-100-percent  H-font-size-15 H-border-none H-padding-vertical-both-12 H-padding-horizontal-both-20  H-theme-font-color-white ">
				开始洗衣
			</button>
		</div>
		<div class="H-text-list H-flexbox-horizontal  H-border-vertical-bottom-after H-vertical-middle H-touch-active">
			<div class="xy_font_color H-flex-item H-padding-horizontal-both-15 H-font-size-14 H-padding-vertical-both-12">
				订单编号: <span id="no"></span>
			</div>
		</div>
		<div class="H-text-list H-flexbox-horizontal  H-border-vertical-bottom-after H-vertical-middle H-touch-active">
			<div class="xy_font_color H-flex-item H-padding-horizontal-both-15 H-font-size-14 H-padding-vertical-both-12">
				下单时间：<span id="time"></span>
			</div>
		</div>
		<div class="H-text-list H-flexbox-horizontal  H-border-vertical-bottom-after H-vertical-middle H-touch-active">
			<div class="xy_font_color H-flex-item H-padding-horizontal-both-15 H-font-size-14 H-padding-vertical-both-12">
				订单金额：<span id="money"></span>元
			</div>
		</div>
		<div class="H-text-list H-flexbox-horizontal  H-border-vertical-bottom-after H-vertical-middle H-touch-active">
			<div class="xy_font_color H-flex-item H-padding-horizontal-both-15 H-font-size-14 H-padding-vertical-both-12">
				选用机器：<span id="machine"></span>
			</div>
		</div>
		<div class="H-text-list H-flexbox-horizontal  H-border-vertical-bottom-after H-vertical-middle H-touch-active">
			<div class="xy_font_color H-flex-item H-padding-horizontal-both-15 H-font-size-14 H-padding-vertical-both-12">
				商品名称：<span id="model"></span>
			</div>
		</div>
		<script type="text/javascript" src="../../../script/xy.js"></script>
		<script type="text/javascript" src="../../../script/tools/jquery.min.js"></script>
		<script type="text/javascript" src="../../../script/tools/jquery.flipcountdown.js"></script>
		<script type="text/javascript">
			apiready = function() {
				data = api.pageParam.data;
				initPage();
			};
			// 初始化页面
			function initPage() {
				//页面渲染
				document.getElementById('no').innerHTML = data.order_id;
				document.getElementById('time').innerHTML = data.reader_time;
				document.getElementById('money').innerHTML = data.pay_num;
				document.getElementById('machine').innerHTML = data.device_name;
				document.getElementById('model').innerHTML = data.title;
				// 初始化时间递减
				api.getPrefs({
					key : 'washtime'
				}, function(ret, err) {
					if (ret && ret.value) {
						//获取之前开始的时间
						var time = eval('(' + ret.value + ')');
						//获取当前时间
						var now = new Date();
						//计算剩余时间
						times = 300 - ((now.getTime() - parseInt(time)) / 1000);
						//调用倒计时方法
						isinerval = setInterval("CountDown()", 1000);
					} else {
						//初始化所用时间
						var stringTime = data[0].reader_time;
						var timestamp2 = Date.parse(new Date(stringTime));
						var now = new Date();
						//计算剩余时间
						times = 300 - ((now.getTime() - parseInt(timestamp2)) / 1000);
						//记录当前时间
						api.setPrefs({
							key : 'washtime',
							value : "'" + now.getTime() + "'"
						});
						//调用倒计时方法
						isinerval = setInterval("CountDown()", 1000);
					}
				});
			}

			//时间递减处理
			function CountDown() {
				$('#retroclockbox').flipcountdown({
					tick : function() {
						//倒计时展示
						var nol = function(h) {
							return h > 9 ? h : '0' + h;
						};
						var minutes = parseInt(times / 60);
						var seconds = parseInt(times % 60);
						return nol(minutes) + ':' + nol(seconds);
					}
				});
				if (times < 1) {
					//结束时间递减
					clearInterval(isinerval);
					api.removePrefs({
						key : 'washtime'
					});
					api.openWin({
						name : 'progress_head',
						url : '../progress/progress_head.html',
						bounces : false,
						delay : 0,
						slidBackEnabled : true,
						vScrollBarEnabled : false
					});
					return;
				}
				times--;
			}

			//开始计时
			function start() {
				api.removePrefs({
					key : 'washtime'
				});
				api.openWin({
					name : 'progress_head',
					url : '../progress/progress_head.html',
					bounces : false,
					delay : 300,
					slidBackEnabled : true,
					vScrollBarEnabled : false
				});
			}
		</script>
	</body>
</html>