<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<title>title</title>
		<link rel="stylesheet" type="text/css" href="../../../css/Hui.css" />
		<link rel="stylesheet" type="text/css" href="../../../css/fonts/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../../css/style.css" />
		<link rel="stylesheet" type="text/css" href="../../../css/animate/animate.min.css" />
		<style>
			.lanse {
				color: #03aafe;
			}
			.icon-zhankai {
				color: #b8b8b8;
			}
		</style>
	</head>
	<body>
		<div id="nonetwork" style="display: none;" tapmode="" onclick="openWifi();">
			<div class="H-margin-vertical-top-10"></div>
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color8 H-border-vertical-bottom-after H-vertical-middle">
				<span class="H-icon H-display-block H-padding-horizontal-left-5"><i class="iconfont icon-guanyuwomen H-theme-font-color-yellow H-font-size-14 H-vertical-middle"></i></span>
				<div class="H-flex-item H-font-size-12 H-padding-10 H-text-show-row-1 H-theme-font-color-white H-text-align-center">
					世界上最遥远的距离就是没网，点击设置
				</div>
				<span class="H-icon H-padding-horizontal-right-5 H-display-block"><i class="iconfont icon-zhankai H-theme-font-color-white H-font-size-12 H-vertical-middle"></i></span>
			</div>
		</div>
		<div id="nearby_laundry"></div>
		<script id="nearby_laundry_list_item" type="text/html">
			{{# for(var i=0,l=d.length;i<l;i++){ }}
			<div class="H-theme-background-color-white H-margin-vertical-bottom-5 animated fadeIn" tapmode="H-touch-active" onclick="open_nearby_machine('{{ d[i].washloca_id }}');">
			<div class="H-flexbox-horizontal H-padding-vertical-top-10 ">
			<span class="H-padding-horizontal-both-10 "><i class="iconfont icon-xiyiji H-font-size-20 xy_font_color"></i></span>
			<div class="H-flex-item xy_font_color">
			<span>{{ d[i].washloca_name }}</span>
			</div>
			<span class="H-theme-font-color-999 H-icon H-padding-horizontal-right-10 H-display-block"><i class="iconfont icon-zhankai H-font-size-18 H-vertical-middle"></i> </span>
			</div>
			<div class="xy_border"></div>
			<div class="H-theme-background-color-white H-theme-font-color-999 H-font-size-13 H-padding-vertical-both-5" style="padding-left: 37px;">
			{{ d[i].washloca_address }}
			<span class="kongxian">2台</span><span class="kongxian">空闲</span>
			<span class=" H-padding-horizontal-right-20 H-float-right">{{ d[i].distance }}m</span>
			</div>
			</div>
			{{# } }}
		</script>
		<!--		<div class="H-theme-background-color-white H-margin-vertical-bottom-5">
		<div class="H-flexbox-horizontal  H-padding-vertical-top-10 ">
		<span class="H-padding-horizontal-both-10 "><i class="iconfont icon-xiyiji H-font-size-20 xy_font_color"></i></span>
		<div class="H-flex-item xy_font_color">
		<span>东区2号宿舍楼</span>
		</div>
		<span class="H-theme-font-color-999 H-icon H-padding-horizontal-right-10 H-display-block"><i class="iconfont icon-zhankai H-font-size-18 H-vertical-middle"></i> </span>
		</div>
		<div class="xy_border"></div>
		<div class="H-theme-background-color-white H-theme-font-color-999 H-font-size-13 H-padding-vertical-both-5" style="padding-left: 37px;">
		河南教育学院 <span class="lanse">2台</span><span class="lanse">空闲</span>
		<span class="H-padding-horizontal-right-20 H-float-right">200米</span>
		</div>
		</div>-->
		<script type="text/javascript" src="../../../script/tools/laytpl.js"></script>
		<script type="text/javascript" src="../../script/api.js"></script>
		<script type="text/javascript" src="../../../script/xy.js"></script>
		<script type="text/javascript">
			var longitude = null, latitude = null;
			apiready = function() {
				api.parseTapmode();
				getlocation();
			};
			function openWin(name, url, washid) {
				var delay = 0;
				if (api.systemType != 'ios') {
					delay = 200;
				}
				api.openWin({
					name : name,
					url : url,
					pageParam : {
						washid : washid
					},
					bounces : false,
					delay : delay,
					slidBackEnabled : true,
					vScrollBarEnabled : false
				});
			}

			//获取位置信息
			function getlocation() {
				var systemType = api.systemType;
				if (systemType == "ios") {
					api.startLocation({
						accuracy : '10m',
						filter : 1,
						autoStop : true
					}, function(ret, err) {
						if (ret.status) {
							api.toast({
								msg : '获取位置成功ios'
							});
							//经度
							longitude = ret.longitude;
							//纬度
							latitude = ret.latitude;
							////获取附近10公里范围内的洗衣点
							api.toast({
								msg : '开始获取位置'
							});
							get_nearby_laundry(longitude, latitude);
						} else {
							api.toast({
								msg : '获取位置失败'
							});
						}
					});
				} else {
					//初始化百度定位模块
					var baiduLocation = api.require('baiduLocation');
					//开始定位
					baiduLocation.startLocation({
						accuracy : '10m',
						filter : 1,
						autoStop : true
					}, function(ret, err) {
						if (ret.status) {
							//						api.toast({
							//							msg : '获取位置成功2'
							//						});
							//经度
							longitude = ret.longitude;
							//纬度
							latitude = ret.latitude;
							//console.log(latitude);
							//获取附近10公里范围内的洗衣点
							get_nearby_laundry(longitude, latitude);
						} else {
							api.toast({
								msg : '获取位置失败'
							});
						}
					});
				}
			}

			//获取附近10公里范围内的洗衣点
			function get_nearby_laundry(longitude, latitude) {
				longitude = longitude;
				latitude = latitude;
				$xy.ajax(function(ret, err) {
					//api.hideProgress();
					if (ret) {
						//$("#nonetwork").hide();
						if (ret.success) {
							console.log("获取成功");
							console.log(JSON.stringify(ret));
							var tpl = document.getElementById('nearby_laundry_list_item').innerHTML;
							//读取模版
							//方式一：异步渲染（推荐）
							laytpl(tpl).render(ret.data, function(render) {
								api.hideProgress();
								document.getElementById('nearby_laundry').innerHTML = render;
							});
						} else {
							console.log(JSON.stringify(ret));
							api.toast({
								msg : '很抱歉，附近没有洗衣点！'
							});
						}
					} else {
						$("#nonetwork").show();
					}
				}, 'getWashLoList&funid=wash_location&gps_longitude=' + longitude + '&gps_latitude=' + latitude);
			}

			//打开该洗衣点下的洗衣机
			function open_nearby_machine(id) {
				api.openWin({
					name : 'nearby_machine_head',
					url : './nearby_machine_head.html',
					pageParam : {
						washloca_id : id,
					},
					delay : 0,
					slidBackEnabled : true,
					vScrollBarEnabled : false
				});
			}
		</script>
	</body>
</html>