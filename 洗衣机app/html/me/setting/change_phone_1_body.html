<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<title>title</title>
		<link rel="stylesheet" type="text/css" href="../../../css/Hui.css" />
		<link rel="stylesheet" type="text/css" href="../../../css/style.css" />
		<link rel="stylesheet" type="text/css" href="../../../css/fonts/iconfont.css" />
		<style>
			html, body {
				background-color: white;
			}
			.active {
				color: #49b1f4;
				/*				border-bottom: 2px #1786FF solid;*/
				border: 1px solid #49b1f4;
			}
			.xy_border {
				border-bottom: 1px solid #f0f0f0;
			}
			.border-dx {
				border-radius: 20px;
			}
		</style>
	</head>
	<body>
		<!--无网络登录和获取验证码优化-->
		<div id="nonetwork" style="display: none;" tapmode="" onclick="openWifi();">
			<div class="H-margin-vertical-top-10"></div>
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color8 H-border-vertical-bottom-after H-vertical-middle">
				<span class="H-icon H-display-block H-padding-horizontal-left-5"><i class="iconfont icon-guanyuwomen H-theme-font-color-yellow H-font-size-14 H-vertical-middle"></i></span>
				<div class="H-flex-item H-font-size-12 H-padding-10 H-text-show-row-1 H-theme-font-color-white H-text-align-center">
					世界上最遥远的距离就是没网，点击设置
				</div>
				<span class="H-icon H-padding-horizontal-right-5 H-display-block"><i class="iconfont icon-zhankai H-theme-font-color-white H-font-size-12 H-vertical-middle"></i></span>
			</div>
		</div>
		<div id="content1" class="H-padding-vertical-top-20">
			<div class="switvh H-font-size-14 ">
				<div class="H-flexbox-horizontal">
					<input type="text" id="tel_phone" class=" H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after H-textbox H-vertical-align-middle H-vertical-middle H-font-size-14 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" style="color:#49b1f4;" placeholder="请输入手机号码">
					<div class="xy_border"></div>
					<div class="H-padding-10">
						<span tapmode onclick="getVerify();" id="sendVerify" class="H-font-size-14 H-theme-background-color-transparent  H-theme-font-color1 H-theme-border-color1 H-theme-border-color1-click H-theme-background-color1-click H-theme-font-color1-click border-dx H-padding-horizontal-both-10 H-padding-vertical-both-5"> 获取验证码 </span>
					</div>
				</div>
				<div class="xy_border"></div>
				<div>
					<input type="text" id="code" class="H-margin-vertical-top-2 H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after H-textbox H-vertical-align-middle H-vertical-middle H-font-size-14 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" style="color:#49b1f4;" placeholder="请输入验证码">
				</div>
				<div class="xy_border"></div>
				<div id="qita" class=" xy_font_color H-font-size-14 H-padding-vertical-bottom-25 H-padding-vertical-top-5" style="padding-left: 37px;">
					<div class="H-float-right">
						<span onclick="ChangesToPwd();">密码验证</span>
						<span class="H-margin-horizontal-left-25 H-padding-horizontal-right-15" onclick="openCustomerService();">联系客服</span>
					</div>
				</div>
				<div class="H-margin-horizontal-both-20 H-padding-vertical-both-15">
					<button tapmode="" onclick="verify_old_phone();" class="xy_login_btn H-margin-vertical-top-2 H-font-size-16 H-button H-padding-vertical-both-10 H-border-none H-width-100-percent   H-theme-font-color-white">
						验&nbsp;&nbsp;&nbsp;证
					</button>
				</div>
			</div>
		</div>
		<div id="content2" style="display: none;" class="switvh H-font-size-14 H-padding-vertical-top-20">
			<div>
				<input type="text" id="pw_phone" class=" H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after H-textbox H-vertical-align-middle H-vertical-middle H-font-size-14 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" style="color:#49b1f4;" placeholder="请输入手机号码">
			</div>
			<div class="xy_border"></div>
			<div>
				<input type="password" id="pw_password" class="H-margin-vertical-top-2 H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after H-textbox H-vertical-align-middle H-vertical-middle H-font-size-14 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" style="color:#49b1f4;" placeholder="请输入密码（6-18位任意字符）">
			</div>
			<div class="xy_border"></div>
			<div id="qita" class=" xy_font_color H-font-size-13 H-padding-vertical-bottom-25 H-padding-vertical-top-5" style="padding-left: 37px;">
				<div class="H-float-right">
					<span onclick="ChangesToPhone();">手机号验证</span>
					<span class="H-margin-horizontal-left-25 H-padding-horizontal-right-15"onclick="openCustomerService();">联系客服</span>
				</div>
			</div>
			<div class="H-margin-horizontal-both-20 H-padding-vertical-both-15">
				<button tapmode="" onclick="verify_old_password();" class="xy_login_btn H-margin-vertical-top-2 H-font-size-16 H-button H-padding-vertical-both-10 H-border-none H-width-100-percent   H-theme-font-color-white">
					验&nbsp;&nbsp;&nbsp;证
				</button>
			</div>
		</div>
		<!--<button tapmode="" onclick="open_change_phone_2();" class="xy_login_btn H-margin-vertical-top-2 H-font-size-16 H-button H-padding-vertical-both-10 H-border-none H-width-100-percent   H-theme-font-color-white">
		打开第二个页面
		</button>-->
	</body>
	<script type="text/javascript" src="../../../script/xy.js"></script>
	<script type="text/javascript" src="../../../script/zepto.min.js"></script>
	<script type="text/javascript">
		var jpush = null, tel = null, jpush = null, systemtype = null;
		var user = null
		var wash_user_id = null;
		var uuid = null;
		var phone = null;
		var phone_number = null;
		apiready = function() {
			api.parseTapmode();
			init();
			listener();
		};
		//初始化信息
		function init() {
			//			jpush = api.require('ajpush');
			//			systemtype = api.systemType;
			api.getPrefs({
				key : 'userinfo'
			}, function(ret, err) {
				if (ret && ret.value) {
					user = eval('(' + ret.value + ')');
					wash_user_id = user[0].wash_user_id;
					uuid = user[0].uuid;
					str = user[0].phone_number;
					tel = str;
					phone_number = str;
					$("#tel_phone").val(tel);
					$("#pw_phone").val(tel);
				}
			});
		}

		//监听网络状态
		function listener() {
			api.addEventListener({
				name : 'offline'
			}, function(ret, err) {
				//$("#nonetwork").show();
			});
			api.addEventListener({
				name : 'online'
			}, function(ret, err) {
				//$("#nonetwork").hide();
				api.toast({
					msg : '已连接到网络',
					duration : 3000
				});
			});
		}

		//点击获取验证码
		function getVerify() {
			var tel = $("#tel_phone").val();
			console.log(tel);
			api.showProgress({
				title : '获取中',
				text : '请稍等....'
			});
			$xy.ajax(function(ret, err) {
				api.hideProgress();
				if (ret) {
					//$("#nonetwork").hide();
					if (ret.success) {
						$('#sendVerify').removeAttr('onclick');
						$('#sendVerify').html('<span id="Verifytime">60</span>s');
						time = 60;
						isinerval = setInterval("CountDown()", 1000);
					} else {
						api.toast({
							msg : '很抱歉，短信获取失败，请稍后再试！',
							location : 'middle'
						});
					}
				} else {
					api.toast({
						msg : '连接失败，请检查网络配置',
						location : 'middle'
					});
					//$("#nonetwork").show();
				}
			}, 'sendtplValue&funid=wash_user&phone_number=' + tel);
		}

		//时间递减处理
		function CountDown() {
			if (time < 1) {
				//              var sendVerify = document.getElementById('sendVerify');
				clearInterval(isinerval);
				$('#sendVerify').attr('onclick', 'getVerify()');
				//$('#sendVerify').attr( 'status', '0');
				$('#sendVerify').html('重新获取');
				return;
			}
			//          var getVerify = document.getElementById('getVerify');
			$('#Verifytime').html('' + time + '');
			time--;
		}

		//正则检验手机号
		function checkPh(tels) {
			tel = $(tels).val();
			// 手机号的正则
			var a = /^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$|17[0-9]{9}$/;
			if (!tel.match(a)) {
				// 如果不是正确的手机号
				api.alert({
					title : '温馨提示',
					msg : '请输入正确的手机号！',
				}, function(ret, err) {
					if (ret && ret.buttonIndex == 1) {
						$("#tel").focus();
					}
				});
				return;
			}
		}

		//验证手机号方法
		function verify_old_phone() {
			var verify = $("#code").val();
			if (verify == "") {
				api.toast({
					msg : "请输入验证码",
					duration : 2000,
					location : 'middle'
				});
				return;
			}
			tel = $('#tel_phone').val();
			// 手机号的正则
			var a = /^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$|17[0-9]{9}$/;
			if (!tel.match(a)) {
				// 如果不是正确的手机号
				api.alert({
					title : '温馨提示',
					msg : '请输入正确的手机号！',
				}, function(ret, err) {
					if (ret && ret.buttonIndex == 1) {
						$("#tel").focus();
					}
				});
				return;
			}
			$xy.ajax(function(ret, err) {
				//api.hideProgress();
				if (ret) {
					//$("#nonetwork").hide();
					api.refreshHeaderLoadDone();
					if (ret.success) {
						console.log(JSON.stringify(ret));
						api.toast({
							msg : '验证成功，开始绑定新手机号码',
							location : 'middle',
							duration : 3000
						});
						setTimeout(open_change_phone_2(), 3000);
						//open_change_phone_2();
					} else {
						//console.log(JSON.stringify(ret));
						api.toast({
							location : 'middle',
							msg : ret.message,
							duration : 3000
						});
					}
				} else {
					//console.log(JSON.stringify("false"));
					//					api.refreshHeaderLoadDone();
					//					$("#nonetwork").show();
				}
			}, 'UpoldPhone&funid=wash_user' + '&verify=' + verify + '&phone_number=' + tel);
		}

		//密码验证方法
		function verify_old_password() {
			var service_password = $("#pw_password").val();
			if (service_password == "") {
				api.toast({
					msg : "请输入服务密码",
					duration : 2000,
					location : 'middle'
				});
			}
			tel = $('#pw_phone').val();
			// 手机号的正则
			var a = /^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$|17[0-9]{9}$/;
			if (!tel.match(a)) {
				// 如果不是正确的手机号
				api.alert({
					title : '温馨提示',
					msg : '请输入正确的手机号！',
				}, function(ret, err) {
					if (ret && ret.buttonIndex == 1) {
						$("#tel").focus();
					}
				});
				return;
			}
			$xy.ajax(function(ret, err) {
				//alert(JSON.stringify(ret));
				if (ret.success) {
					$xy.ajax(function(ret, err) {
						//api.hideProgress();
						if (ret) {
							//					console.log("wash_user_id:" + wash_user_id);
							//					console.log("uuid:" + uuid);
							//					console.log("phone_number:" + phone_number);
							//					console.log("verify:" + verify);
							//					console.log("service_password:" + service_password);
							//					console.log(JSON.stringify(ret));
							//$("#nonetwork").hide();
							api.refreshHeaderLoadDone();
							if (ret.success) {
								console.log(JSON.stringify(ret));
								api.toast({
									msg : '验证成功，开始绑定新手机号码',
									location : 'middle',
									duration : 3000
								});
								setTimeout(open_change_phone_2(), 3000);
								//open_change_phone_2();
							} else {
								//console.log(JSON.stringify(ret));
								api.toast({
									location : 'middle',
									msg : ret.message
								});
							}
						} else {
							//console.log(JSON.stringify("false"));
							//					api.refreshHeaderLoadDone();
							//					$("#nonetwork").show();
						}
					}, 'UpoldPhone&funid=wash_user' + '&phone_number=' + tel + '&service_password=' + service_password);
				} else {
					api.getPrefs({
						key : 'userinfo'
					}, function(ret, err) {
						if (ret && ret.value) {
							//							var user = eval('(' + ret.value + ')');
							api.toast({
								msg : '您未设置密码'
							});
							setTimeout(function() {
								var delay = 0;
								if (api.systemType != 'ios')
									delay = 100;
								api.openWin({
									name : 'pwd_set_head',
									url : 'pwd_set_head.html',
									bounces : false,
									delay : delay,
									vScrollBarEnabled : false
								});
							}, 800);
						} else {
							api.toast({
								msg : '请先登录'
							});
							setTimeout(function() {
								var delay = 0;
								if (api.systemType != 'ios')
									delay = 100;
								api.openWin({
									name : 'login_body',
									url : '../../login/login_body.html',
									bounces : false,
									delay : delay,
									vScrollBarEnabled : false
								});
							}, 800);
						}
					});
				}
			}, 'judgePdNull&funid=wash_user' + '&phone_number=' + tel);
		}

		//改变为密码验证
		function ChangesToPwd() {
			document.getElementById("code").value = "";
			$("#content1").css("display", "none");
			$("#content2").css("display", "block");
			//			console.log(wash_user_id);
			//			console.log(uuid);
		}

		//改变为手机号验证按钮
		function ChangesToPhone() {
			document.getElementById("pw_password").value = "";
			$("#content2").css("display", "none");
			$("#content1").css("display", "block");
		}

		//打开联系客服页面
		function openCustomerService() {
			api.openWin({
				name : 'custom_server_head.html',
				url : '../server/custom_server_head.html',
				bounces : false,
				delay : 0,
				slidBackEnabled : true,
				vScrollBarEnabled : false
			});
		}

		//打开更新新手机号页面
		function open_change_phone_2() {
			var verify = $("#code").val();
			var service_password = $("#pw_password").val();
			var delay = 0;
			if (api.systemType != 'ios')
				delay = 100;
			api.openWin({
				name : 'change_phone_2_head',
				url : './change_phone_2_head.html',
				pageParam : {
//					wash_user_id : wash_user_id,
//					uuid : uuid,
					phone_number : tel,
					verify : verify,
					service_password : service_password
				},
				bounces : false,
				delay : delay,
				slidBackEnabled : true,
				vScrollBarEnabled : false
			});
		}
	</script>
</html>