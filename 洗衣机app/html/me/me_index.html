<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>我的首页</title>
		<link rel="stylesheet" type="text/css" href="../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../../css/Hui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../css/style.css" />
		<style>
			.back {
				background-image: url('../../image/mebackground.png');
				background-position: center;
				background-size: cover;
				position:relative;
				top: 0px;
				left: 0px;
			}
			.hu {
				height: 120px;
			}
			.font-active {
				font-size: 20px;
			}
			.pic {
				width: 100px;
				height: 100px;
				border-radius: 50%;
				/*position: absolute;
				 top: 7.3px;
				 left: 132px;*/
			}
		</style>
	</head>
	<body>
		<div class="back">
			<div class="hu H-center-all" tapmode onclick="openUser();">
				<img src="../../image/noavatar.gif" onerror="javascript:this.style.display='none'" id="nopic" class="pic" style="display: none" />
			</div>
			<div class="H-padding-vertical-top-10 H-text-align-center H-font-size-16">
				<span class="H-theme-font-color-white H-font-weight-bold" id="userTel">未登录</span>
			</div>
			<div class="H-padding-2 H-text-align-center H-font-size-13">
				<span class="H-theme-font-color-white">共洗衣<span id="nums">0</span>次</span>
			</div>
			<div class="H-flexbox-horizontal">
				<div class="H-flex-item" tapmode="font-active" onclick="openWalletWin();">
					<div class="H-padding-vertical-bottom-8"></div>
					<span class="H-font-size-14 H-theme-font-color-white H-horizontal-center">总余额 ：<span class="H-font-size-20 H-theme-font-color-white " id="pu"> ￥0.00 </span>元</span>
				</div>
				<!--<div class="H-flex-item" tapmode="font-active" onclick="openWalletWin();">
				<div class="H-padding-vertical-bottom-8"></div>
				<div class="H-font-size-18 H-theme-font-color-white H-horizontal-center" id="ding">
				￥0.00
				</div>
				<div class="H-font-size-12 H-theme-font-color-white H-horizontal-center">
				定向余额
				</div>
				</div>-->
			</div>
			<div class="H-padding-15"></div>
		</div>
		<div class="H-padding-vertical-bottom-25 H-theme-background-color-white"></div>
		<div class="H-border-vertical-bottom-after H-text-list  H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-touch-active" tapmode="H-touch-active"="H-touch-active" onclick="openUser();">
			<img src="../../image/xinxishezhi.gif" width="16px" height="16px" class="H-padding-horizontal-both-10 H-vertical-middle">
			<div class="H-flex-item  H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">
				信息设置
			</div>
			<span class="H-theme-font-color-999 H-icon H-padding-horizontal-right-10 H-display-block"><i class="iconfont icon-zhankai H-font-size-18 H-vertical-middle"></i> </span>
		</div>
		<!--<div class="H-text-list H-border-vertical-bottom-after H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-touch-active" tapmode="H-touch-active" onclick="openWin('fault_feedback_head','./feedback/fault_feedback_head.html');">
		<img src="../../image/guzhangfankui.gif" width="16px" height="16px" class="H-padding-horizontal-both-10 H-vertical-middle">
		<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">
		故障反馈
		</div>
		<span class="H-theme-font-color-999 H-icon H-padding-horizontal-right-10 H-display-block"><i class="iconfont icon-zhankai H-font-size-18 H-vertical-middle"></i> </span>
		</div>-->
		<div class="H-text-list H-border-vertical-bottom-after  H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-touch-active" tapmode="H-touch-active" onclick="openWin('about_us_head','about_us_head.html');">
			<span class="H-padding-horizontal-both-8 H-vertical-middle"><i class="iconfont icon-guanyuwomen H-theme-font-color-999 H-font-size-20"></i></span>
			<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">
				关于我们
			</div>
			<span class="H-theme-font-color-999 H-icon H-padding-horizontal-right-10 H-display-block"><i class="iconfont icon-zhankai H-font-size-18 H-vertical-middle"></i> </span>
		</div>
		<div class="H-text-list H-border-vertical-bottom-after  H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-touch-active" tapmode="H-touch-active" onclick="openWin('custom_server_head','./server/custom_server_head.html');">
			<img src="../../image/lianxikefu.gif" width="16px" height="16px" class="H-padding-horizontal-both-10 H-vertical-middle">
			<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">
				联系客服
			</div>
			<span class="H-theme-font-color-999 H-icon H-padding-horizontal-right-10 H-display-block"><i class="iconfont icon-zhankai H-font-size-18 H-vertical-middle"></i> </span>
		</div>
		<div class="H-text-list H-border-vertical-bottom-after  H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-touch-active" tapmode="H-touch-active" onclick="cleanCache();">
			<span class="H-padding-horizontal-both-8 H-vertical-middle"><i class="iconfont icon-qingchuhuancun H-theme-font-color-999 H-font-size-20"></i></span>
			<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">
				清除缓存
			</div>
			<label class="H-display-inline-block H-vertical-middle H-theme-font-color-ccc H-font-size-12 H-padding-horizontal-right-8">当前缓存：<span id="cache" class="H-theme-font-color-999">0.00M</span></label>
			<span class="H-theme-font-color-999 H-icon H-padding-horizontal-right-10 H-display-block"><i class="iconfont icon-zhankai H-font-size-18 H-vertical-middle"></i> </span>
		</div>
		<div class="H-text-list H-border-vertical-bottom-after  H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-touch-active" tapmode="H-touch-active" onclick="openWin('help_center_head', './help_center/help_center_head.html');">
			<span class="H-padding-horizontal-both-10 H-vertical-middle"><i class="iconfont icon-bangzhuzhongxin H-theme-font-color-999 "></i></span>
			<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">
				帮助中心
			</div>
			<span class="H-theme-font-color-999 H-icon H-padding-horizontal-right-10 H-display-block"><i class="iconfont icon-zhankai H-font-size-18 H-vertical-middle"></i> </span>
		</div>
		<!--		<div class="H-text-list H-border-vertical-bottom-after  H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-touch-active" tapmode="H-touch-active" onclick="Send_notifications();">
		<span class="H-padding-horizontal-both-10 H-vertical-middle"><i class="iconfont icon-bangzhuzhongxin H-theme-font-color-999 "></i></span>
		<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">
		测试专用
		</div>
		<span class="H-theme-font-color-999 H-icon H-padding-horizontal-right-10 H-display-block"><i class="iconfont icon-zhankai H-font-size-18 H-vertical-middle"></i> </span>
		</div>-->
	</body>
	<script type="text/javascript" src="../../script/xy.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../scritp/uploading/upImg.js"></script>
	<script type="text/javascript">
		var user = null, dxmoney = null;
		apiready = function() {
			api.parseTapmode();
			initPref();
			//获取缓存
			api.getCacheSize(function(ret) {
				var size = ret.size;
				size = size / (1024 * 1024);
				$("#cache").html(size.toFixed(2) + 'M');
			});
			//监听事件
			api.addEventListener({
				name : 'reload'
			}, function(ret, err) {
				//刷新
				location.reload();
			});
		};
		//获取偏好值
		function initPref() {
			var marl = (api.frameWidth - 100) / 2;
			$(".hu").css('margin-left', marl);
			$(".hu").css('margin-right', marl);
			api.getPrefs({
				key : 'userinfo'
			}, function(ret, err) {
				//alert(JSON.stringify(user));
				if (ret && ret.value) {
					user = eval('(' + ret.value + ')');
					$xy.ajax(function(ret, err) {
						//api.hideProgress();
						if (ret.success) {
							retInfo = ret.data;
							//console.log(JSON.stringify(retInfo));
							api.setPrefs({
								key : 'userinfo',
								value : JSON.stringify(retInfo)
							});
							//手机号
							$("#userTel").html(retInfo[0].phone_number);
							//定向余额
							if (retInfo[0].orient_overage != "") {
								//$("#ding").html(user[0].orient_overage);
								dxmoney = parseFloat(user[0].orient_overage);
							} else {
								dxmoney = 0;
							};
							//账户余额
							if (retInfo[0].account_overage != "") {
								var total = parseFloat(user[0].account_overage) + dxmoney;
								document.getElementById('pu').innerHTML = total.toFixed(2);
							};
							//洗衣总次数
							if (retInfo[0].wash_total) {
								$("#nums").html(user[0].wash_total);
							}
							//渲染头像
							if (retInfo[0].attach_path != "") {
								$("#nopic").show();
								$("#nopic").attr('src', window.washUrl + user[0].attach_path);
							}
						} else {
							api.toast({
								msg : '您的登录状态异常'
							});
						}
					}, 'appUserInfo&funid=wash_user&wash_user_id=' + user[0].wash_user_id + '&uuid=' + user[0].uuid);
				}
			});
		};
		//清除缓存
		function cleanCache() {
			api.clearCache(function() {
				api.toast({
					msg : '清除完成'
				});
				//获取缓存大小
				api.getCacheSize(function(ret) {
					var size = ret.size;
					size = size / (1024 * 1024);
					$("#cache").html(size.toFixed(2) + 'M');
				});
			});
		};
		//打开个人中心或登录页
		function openUser() {
			var delay = 0;
			if (api.systemType != 'ios')
				delay = 100;
			if (user) {
				api.openWin({
					name : 'user_set_head',
					url : 'user_set_head.html',
					bounces : false,
					delay : delay,
					slidBackEnabled : true,
					vScrollBarEnabled : false,
					hScrollBarEnabled : false
				});
			} else {
				api.openWin({
					name : 'login_body',
					url : '../login/login_body.html',
					bounces : false,
					delay : delay,
					slidBackEnabled : true,
					vScrollBarEnabled : false,
					hScrollBarEnabled : false
				});
			}
		};
		//打开窗口
		function openWin(name, url) {
			//			var sys = api.systemType;
			//			//安卓加载延迟设置
			//			sys != "ios" ? delay = 200 : delay = 0;
			api.openWin({
				name : name,
				url : url,
				bounces : false,
				delay : 0,
				slidBackEnabled : true,
				vScrollBarEnabled : false,
				hScrollBarEnabled : false,
				animation : {
					//					type : "none", //动画类型（详见动画类型常量）
					subType : "from_right", //动画子类型（详见动画子类型常量）
					duration : 300 //动画过渡时间，默认300毫秒
				}
			});
		};
		//打开图片预览
		function openbrowse() {
			var photoBrowser = api.require('photoBrowser');
			var picurl = $("#nopic").attr('src');
			photoBrowser.open({
				images : [picurl],
				bgColor : '#000'
			}, function(ret, err) {
				if (ret) {
					api.execScript({
						name : 'main',
						script : 'photoClose();'
					});
					if (ret.eventType == "click") {
						photoBrowser.close();
					}
					//alert(JSON.stringify(ret));
				} else {
					alert(JSON.stringify(err));
				}
			});
		};
		//关闭图片预览
		function exec() {
			var photoBrowser = api.require('photoBrowser');
			photoBrowser.close();
		}

		//打开我的钱包
		function openWalletWin() {
			var delay = 0;
			if (api.systemType != 'ios')
				delay = 100;
			if (user) {
				api.openWin({
					name : 'my_wallet_head',
					url : './my_wallet/my_wallet_head.html',
					pageParam : {
						data : user[0]
					},
					bounces : false,
					delay : delay,
					slidBackEnabled : true,
					vScrollBarEnabled : false,
					hScrollBarEnabled : false
				});
			} else {
				api.toast({
					msg : '请点击‘未登录’进行登录'
				});
			}
		};
	</script>
</html>