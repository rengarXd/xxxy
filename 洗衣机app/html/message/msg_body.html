<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<title>title</title>
		<link rel="stylesheet" type="text/css" href="../../css/Hui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../css/style.css" />
		<style>
			.lanse {
				color: #03aafe;
			}
			.chense {
				color: #ff7200;
			}
			.xy_border {
				border-bottom: 1px solid #f0f0f0;
				margin-left: 20px;
				margin-right: 20px;
			}
		</style>
	</head>
	<body>
		<div class="H-theme-background-color-white H-font-size-12 H-padding-horizontal-left-10 H-padding-vertical-both-5 H-margin-vertical-bottom-5">
			<span class="H-font-size-14 H-theme-font-color-999">消息状态：</span>
			<div class="H-float-right H-display-inline H-padding-horizontal-right-10">
				<span style="background-color: #ff7200;" >&nbsp;</span><span class=" H-padding-horizontal-both-8">已读</span>
				<span style="background-color: #03aafe;" >&nbsp;</span><span class=" H-padding-horizontal-left-8">未读</span>
			</div>
		</div>
		<div id="message_html">
			<div class="H-position-absolute H-position-center-all" id="statuss">
				<div class="H-font-size-14 H-text-align-center">
					<i class="iconfont icon-webiconxiyiji H-font-size-32 H-theme-font-color-999"></i>
					<div class="H-theme-font-color-999" id="jiazai">
						加载中
					</div>
				</div>
			</div>
		</div>

		<script type="text/html" id="message_data">
			{{# for(var i=0,len=d.length;i<len;i++) { }}
			<div class=" H-theme-background-color-white H-margin-vertical-bottom-5">
			<div class="H-channel-title H-flexbox-horizontal H-theme-background-color-white H-vertical-middle" tapmode="" onclick="openOrder(this);">
			{{# if (d[i].is_read == 1){ }}
			<div style="background-color: #ff7200;" class="H-channel-line H-padding-vertical-top-15 H-padding-horizontal-left-3 H-margin-horizontal-left-10"></div>
			{{# }else{ }}
			<div style="background-color: #03aafe;" class="H-channel-line H-padding-vertical-top-15 H-padding-horizontal-left-3 H-margin-horizontal-left-10"></div>
			{{# } }}
			<div class="H-channel-text H-theme-font-color4 H-flex-item H-font-size-16 H-theme-font-color-black H-padding-10 H-margin-horizontal-right-10 H-text-show-row-1 chense">
			{{ d[i].news_tital }}
			</div>
			{{# var strtime = d[i].publish_time }}
			{{# var start_time = Date.parse(new Date(strtime))/1000; }}
			<span class="H-theme-font-color-999 H-font-size-12 H-margin-horizontal-right-25">{{ $xy.jsDateDiff(start_time)}}</span>
			</div>
			<div class="xy_border"></div>
			<div class="H-theme-background-color-white H-theme-font-color-999 H-font-size-13 H-padding-vertical-both-5" style="padding-left: 20px;padding-right: 20px;">
			{{ d[i].news_content }}
			</div>
			</div>
			{{# } }}
		</script>
		<script type="text/javascript" src="../../script/xy.js"></script>
		<script type="text/javascript" src="../../script/tools/laytpl.js"></script>
		<script type="text/javascript">
			var user = null;
			apiready = function() {
				intuser();
				//下拉刷新
				api.setRefreshHeaderInfo({
					visible : true,
					bgColor : '#fff',
					textColor : '#666666',
					textDown : '下拉刷新...',
					textUp : '松开刷新...',
					showTime : true
				}, function(ret, err) {
					location.reload();
				});
			};
			function intuser() {
				api.getPrefs({
					key : 'userinfo'
				}, function(ret, err) {
					if (ret && ret.value) {
						user = eval('(' + ret.value + ')');
						initpage();
					} else {
						var htmls = '<div class="H-position-absolute H-position-center-all" id="statuss"><div class="H-font-size-14 H-text-align-center"><i class="iconfont icon-webiconxiyiji H-font-size-32 H-theme-font-color-999"></i><div class="H-theme-font-color-999">请先登录</div></div></div>';
						document.getElementById('order_list').innerHTML = htmls;
					}
				});
			}

//查看详情，更改颜色
			function openOrder() {
				$xy.ajax(function(ret, err) {
					//api.hideProgress();
					if (ret.success) {
						//console.log(JSON.stringify(ret));
						if (ret.data.length == 0) {
							//当没有订单时的处理
							api.refreshHeaderLoadDone();
							var htmls = '<div class="H-position-absolute H-position-center-all" id="statuss"><div class="H-font-size-14 H-text-align-center"><i class="iconfont icon-webiconxiyiji H-font-size-32 H-theme-font-color-999"></i><div class="H-theme-font-color-999">暂无消息记录</div></div></div>';
							document.getElementById('message_html').innerHTML = htmls;
						} else {
							//console.log(JSON.stringify(ret));
							api.refreshHeaderLoadDone();
							var tpl = document.getElementById('message_data').innerHTML;
							//读取模版
							//方式一：异步渲染（推荐）
							laytpl(tpl).render(ret.data, function(render) {
								//api.hideProgress();
								document.getElementById('message_html').innerHTML = render;
							});
						}
					} else {
						//console.log(JSON.stringify(ret));
						$("#jiazai").html("服务器未响应");
					}
				}, 'appNewsInfo&funid=wash_user_new&wash_user_id=' + user[0].wash_user_id + '&uuid=' + user[0].uuid + '&news_id=' + user[0].news_id);

			}

			function initpage() {
				$xy.ajax(function(ret, err) {
					//api.hideProgress();
					if (ret.success) {
						//console.log(JSON.stringify(ret));
						if (ret.data.length == 0) {
							//当没有订单时的处理
							api.refreshHeaderLoadDone();
							var htmls = '<div class="H-position-absolute H-position-center-all" id="statuss"><div class="H-font-size-14 H-text-align-center"><i class="iconfont icon-webiconxiyiji H-font-size-32 H-theme-font-color-999"></i><div class="H-theme-font-color-999">暂无消息记录</div></div></div>';
							document.getElementById('message_html').innerHTML = htmls;
						} else {
							//console.log(JSON.stringify(ret));
							api.refreshHeaderLoadDone();
							var tpl = document.getElementById('message_data').innerHTML;
							//读取模版
							//方式一：异步渲染（推荐）
							laytpl(tpl).render(ret.data, function(render) {
								//api.hideProgress();
								document.getElementById('message_html').innerHTML = render;
							});
						}
					} else {
						api.refreshHeaderLoadDone();
						//console.log(JSON.stringify(ret));
						var htmls = '<div class="H-position-absolute H-position-center-all" id="statuss"><div class="H-font-size-14 H-text-align-center"><i class="iconfont icon-webiconxiyiji H-font-size-32 H-theme-font-color-999"></i><div class="H-theme-font-color-999">服务器未响应</div></div></div>';
						document.getElementById('message_html').innerHTML = htmls;
					}
				}, 'appUserNews&funid=wash_user_new&wash_user_id=' + user[0].wash_user_id + '&uuid=' + user[0].uuid);
			}
		</script>
	</body>
</html>