<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<title>title</title>
		<link rel="stylesheet" type="text/css" href="../../css/Hui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css" />
		<style>
				html,
			body {
				background-image: url('../../image/login_bg.png');
				background-size: cover;
			}
			
			.active {
				color: #49b1f4;
				/*				border-bottom: 2px #1786FF solid;*/
				border: 1px solid #49b1f4;
			}
			
			.xy_border {
				border-bottom: 1px solid #f0f0f0;
		</style>
	</head>

	<body>
		<!--无网络登录和获取验证码优化-->
		<div id="nonetwork" style="display: none;" tapmode="" onclick="openWifi();">
			<div class="H-margin-vertical-top-10"></div>
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color8 H-border-vertical-bottom-after H-vertical-middle">
				<span class="H-icon H-display-block H-padding-horizontal-left-5"><i class="iconfont icon-guanyuwomen H-theme-font-color-yellow H-font-size-14 H-vertical-middle"></i></span>
				<div class="H-flex-item H-font-size-12 H-padding-10 H-text-show-row-1 H-theme-font-color-white H-text-align-center">
					世界上最遥远的距离就是没网，点击设置
				</div>
				<span class="H-icon H-padding-horizontal-right-5 H-display-block"><i class="iconfont icon-zhankai H-theme-font-color-white H-font-size-12 H-vertical-middle"></i></span>
			</div>
		</div>

		<div style="height: 240px;"></div>
		<div>
			<div id="tab" class="H-flexbox-horizontal">
				<div class="H-flex-item H-center-all H-padding-vertical-both-10 H-theme-border-color-white H-touch-active H-font-size-12 active" style="border-width: 0 0 2px  0">
					验证码快捷登录
				</div>
				<div class="H-flex-item H-center-all H-padding-vertical-both-10 H-theme-border-color-white H-touch-active H-font-size-12" style="border-width: 0 0 2px  0">
					密码登录
				</div>

			</div>
			<div class="xy_border"></div>
			<div id="content">
				<div class="switvh H-font-size-14 ">
					<div class="H-flexbox-horizontal">
						<input type="text" class=" H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after H-textbox H-vertical-align-middle H-vertical-middle H-font-size-14 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" style="color:#49b1f4;" placeholder="请输入手机号码">
						<div class="H-padding-10">
							<button class="H-font-size-14 H-theme-background-color-transparent  H-theme-font-color1 H-theme-border-color1 H-theme-border-color1-click H-theme-background-color1-click H-theme-font-color1-click" style="border-radius: 10px;">获取验证码
					</button>
						</div>

					</div>
					<div class="xy_border"></div>
					<div>
						<input type="text" class="H-margin-vertical-top-2 H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after H-textbox H-vertical-align-middle H-vertical-middle H-font-size-14 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" style="color:#49b1f4;" placeholder="请输入验证码">
					</div>
					<div class="xy_border"></div>
					<div class="H-theme-background-color-white H-theme-font-color-999 H-font-size-14 H-padding-vertical-both-5">
						<input type="checkbox" class="H-checkbox H-checkbox-null H-vertical-align-middle H-font-size-18 H-theme-font-color1 H-border-radius-circle">同意《用户协议》
					</div>
					<div class="H-margin-horizontal-both-20 H-padding-vertical-both-15">
						<button tapmode="" onclick="login();" class="H-margin-vertical-top-2 H-font-size-16 H-button H-padding-vertical-both-10 H-border-none H-width-100-percent H-border-radius-15 H-theme-border-color9-click H-theme-font-color-white " style="background-color: #0c9fff;">
							登&nbsp;&nbsp;&nbsp;录
						</button>
					</div>

				</div>
				<div style="display: none;" class="switvh H-font-size-14">
					<div>
						<input type="text" class=" H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after H-textbox H-vertical-align-middle H-vertical-middle H-font-size-14 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" style="color:#49b1f4;" placeholder="请输入手机号码">
					</div>
					<div class="xy_border"></div>
					<div>
						<input type="text" class="H-margin-vertical-top-2 H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after H-textbox H-vertical-align-middle H-vertical-middle H-font-size-14 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" style="color:#49b1f4;" placeholder="请输入密码">
					</div>
					<div class="xy_border"></div>

					<div class="H-margin-horizontal-both-20 H-padding-vertical-both-15">
						<button tapmode="" onclick="login();" class="H-margin-vertical-top-2 H-font-size-16 H-button H-padding-vertical-both-10 H-border-none H-width-100-percent H-border-radius-15 H-theme-border-color9-click H-theme-font-color-white " style="background-color: #0c9fff;">
							登&nbsp;&nbsp;&nbsp;录
						</button>
					</div>
				</div>
			</div>
		</div>

	</body>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/xy.js"></script>
	<script type="text/javascript">
		var jpush = null,
			tel = null,
			time = null,
			jpush = null,
			systemtype = null;
		apiready = function() {
			api.parseTapmode();
			init();
			listener();
		};
		//初始化信息
		function init() {
			jpush = api.require('ajpush');
			systemtype = api.systemType;
		}

		Zepto(function($) {

			$("#tab div").click(function() {
				console.log(111111);
				$("#tab div").eq($(this).index()).addClass('active').siblings().removeClass('active');
				$("#content .switvh").hide().eq($(this).index()).show();
			});
		});
		//监听网络状态
		function listener() {
			api.addEventListener({
				name: 'offline'
			}, function(ret, err) {
				$("#nonetwork").show();
			});
			api.addEventListener({
				name: 'online'
			}, function(ret, err) {
				$("#nonetwork").hide();
				api.toast({
					msg: '已连接到网络'
				});
			});
		}

		//点击获取验证码
		function getVerify() {
			var tel = $("#tel").val();
			// 手机号的正则
			var a = /^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$|17[0-9]{9}$/;
			// 判断手机号
			if(tel.length != 11 || !tel.match(a)) {
				// 如果不是正确的手机号
				alert("请输入正确的手机号！");
			} else {
				api.showProgress({
					title: '获取中',
					text: '请稍等....'
				});
				$xy.ajax(function(ret, err) {
					api.hideProgress();
					if(ret) {
						alert(JSON.stringify(ret));
					} else {
						alert(JSON.stringify(err));
					}
					//					if (ret) {
					//						$("#nonetwork").hide();
					//						//发送验证码成功
					//						switch(ret.retCode) {
					//							case 0:
					//								$('#sendVerify').removeAttr('onclick');
					//								$('#sendVerify').html('<span id="getVerify">120</span>s');
					//								time = 120;
					//								isinerval = setInterval("CountDown()", 1000);
					//								break;
					//							case 1:
					//								api.toast({
					//									msg : '很抱歉，短信获取失败，请稍后再试！'
					//								});
					//								break;
					//						}
					//					} else {
					//						if (err && err.code == 0) {
					//							$("#nonetwork").show();
					//						}
					//					}
				}, 'sendtplValue&funid=wash_user&phone_number=' + tel);
			}
		}

		//时间递减处理
		function CountDown() {
			if(time < 1) {
				//              var sendVerify = document.getElementById('sendVerify');
				$('#sendVerify').attr('onclick', 'getVerify()');
				//$('#sendVerify').attr( 'status', '0');
				$('#sendVerify').html('重新获取');
				clearInterval(isinerval);
				return;
			}
			//          var getVerify = document.getElementById('getVerify');
			$('#getVerify').html('' + time + '');
			time--;
		}

		//登录按钮
		function login_btn() {
			var tel = $("#tel").val();
			//获取验证码
			var code = $("#code").val();
			// 手机号的正则
			var a = /^((\(\d{3}\))|(\d{3}\-))?13\d{9}|14[57]\d{8}|15\d{9}|18\d{9}$/;
			// 判断手机号
			if(tel.length != 11 || !tel.match(a)) {
				// 如果不是正确的手机号
				api.alert({
					title: '温馨提示',
					msg: '请输入正确的手机号！',
				}, function(ret, err) {
					if(ret && ret.buttonIndex == 1) {
						$("#tel").focus();
					}
				});
				return;
			}
			if(code.length !== 4) {
				alert("抱歉验证码格式错误");
				return;
			}
			api.showProgress({
				title: "登录中"
			});
			$xy.ajax(function(ret, err) {
				api.hideProgress();
				if(ret) {
					$("#nonetwork").hide();
					switch(ret.retCode) {
						//登录成功
						case 0:
							//存储用户数据
							api.setPrefs({
								key: 'userinfo',
								value: JSON.stringify(ret.retValue)
							});
							//延时关闭窗口
							setTimeout(function() {
								api.closeWin();
							}, 2000);
							//初始化推送
							if(systemtype != "ios") {
								//初始化android推送
								jpush.init(function(ret) {
									if(ret && ret.status) {
										//注册设备
										jpush.getRegistrationId(function(ret) {
											var registrationId = ret.id;
											$xy.ajax(function(ret, err) {
												//                                  console.log("绑定成功！");
											}, '...' + registrationId);
										});
									}
								});
							} else {
								//适配ios推送
								//注册设备
								jpush.getRegistrationId(function(ret) {
									var registrationId = ret.id;
									$xy.ajax(function(ret, err) {
										//                                  console.log("绑定成功！");
									}, '...' + registrationId);
								});
							}
							break;
						case 1:
							alert(ret.retDesc);
							break;
						case 2:
							alert(ret.retDesc);
							break;
						case 3:
							alert(ret.retDesc);
							break;
					}
				} else {
					if(err && err.code == 0) {
						$("#nonetwork").show();
					}
				}
			}, 'appRegister&funid=wash_user&phone_number=' + tel + '&verify=' + code);
		}
	</script>

</html>